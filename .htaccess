 <IfModule mod_rewrite.c>
 RewriteEngine on
 RewriteOptions inherit
 
 # SSL et Let's Encrypt - Redirection HTTPS
 RewriteCond %{HTTPS} !=on
 RewriteRule .* https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]
 
 # Redirection www vers non-www (ou inversement selon votre préférence)
 # Décommentez l'une des deux options ci-dessous :
 
 # Option 1 : Rediriger www vers non-www
 RewriteCond %{HTTP_HOST} ^www\.(.*)$ [NC]
 RewriteRule ^(.*)$ https://%1/$1 [R=301,L]
 
 # Option 2 : Rediriger non-www vers www
 # RewriteCond %{HTTP_HOST} !^www\. [NC]
 # RewriteRule ^(.*)$ https://www.%{HTTP_HOST}/$1 [R=301,L]
 
 # Supprimer l'extension .php des URL
 # Si un fichier .php existe, le rendre accessible sans extension
 RewriteCond %{REQUEST_FILENAME} !-d
 RewriteCond %{REQUEST_FILENAME}\.php -f
 RewriteRule ^(.+)$ $1.php [L,QSA]
 
 # Rediriger les URL avec .php vers URL sans .php
 RewriteCond %{THE_REQUEST} ^GET\ /[^?\s]+\.php
 RewriteRule ^(.+)\.php$ /$1 [R=301,L]
 
 # Rediriger index.php vers la racine
 RewriteCond %{THE_REQUEST} ^GET\ .*/index\.php
 RewriteRule ^(.+)/index\.php$ /$1/ [R=301,L]
 
# Ajouter un slash final aux répertoires (sauf fichiers avec extension)
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_URI} !(.*)/$
RewriteCond %{REQUEST_URI} !\.(pdf|jpg|jpeg|png|gif|css|js|txt|xml|ico|svg|webp|mp4|webm)$
 RewriteRule ^(.*)$ https://%{HTTP_HOST}/$1/ [R=301,L]
 </IfModule>
 
 # Compression GZIP pour améliorer les performances
 <IfModule mod_deflate.c>
   AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
 </IfModule>
 
 # Mise en cache des fichiers statiques
 <IfModule mod_expires.c>
   ExpiresActive On
   
   # Images
   ExpiresByType image/jpg "access plus 1 year"
   ExpiresByType image/jpeg "access plus 1 year"
   ExpiresByType image/gif "access plus 1 year"
   ExpiresByType image/png "access plus 1 year"
   ExpiresByType image/webp "access plus 1 year"
   ExpiresByType image/svg+xml "access plus 1 year"
   ExpiresByType image/x-icon "access plus 1 year"
   
   # CSS et JavaScript
   ExpiresByType text/css "access plus 1 month"
   ExpiresByType application/javascript "access plus 1 month"
   ExpiresByType text/javascript "access plus 1 month"
   
   # Fonts
   ExpiresByType font/woff "access plus 1 year"
   ExpiresByType font/woff2 "access plus 1 year"
   ExpiresByType application/font-woff "access plus 1 year"
   ExpiresByType application/font-woff2 "access plus 1 year"
   
   # HTML et autres
   ExpiresByType text/html "access plus 1 hour"
   ExpiresByType application/pdf "access plus 1 month"
 </IfModule>
 
 # Sécurité : désactiver la liste des fichiers
 Options -Indexes
 
 # En-têtes de sécurité pour le SEO et la sécurité
 <IfModule mod_headers.c>
   Header set X-Content-Type-Options "nosniff"
   Header set X-Frame-Options "SAMEORIGIN"
   Header set X-XSS-Protection "1; mode=block"
   Header set Referrer-Policy "strict-origin-when-cross-origin"
   
   # Cache-Control pour les ressources statiques
   <FilesMatch "\.(ico|pdf|flv|jpg|jpeg|png|gif|webp|svg|js|css|woff|woff2|ttf|eot)$">
     Header set Cache-Control "max-age=31536000, public, immutable"
   </FilesMatch>
 </IfModule>
 
 # Charset UTF-8 par défaut
 AddDefaultCharset UTF-8
 
 # Protection contre les injections
 <IfModule mod_rewrite.c>
   RewriteCond %{QUERY_STRING} (<|%3C).*script.*(>|%3E) [NC,OR]
   RewriteCond %{QUERY_STRING} GLOBALS(=|[|%[0-9A-Z]{0,2}) [OR]
   RewriteCond %{QUERY_STRING} _REQUEST(=|[|%[0-9A-Z]{0,2})
   RewriteRule ^(.*)$ index.php [F,L]
 </IfModule>